!function(a){"use strict";a.Ghostbin=function(){var b,c;return{formatDuration:function(a){return a=0|a,60>a?""+a+"s":3600>a?""+(a/60|0)+"m"+(a%60|0)+"s":""+(a/3600|0)+"h"+(a%3600/60|0)+"m"+(a%60|0)+"s"},loadLanguages:function(){var a={more:!1,results:[]},d={};$.ajax({url:"/languages.json",async:!1,dataType:"json",cache:!0,success:function(b){$.each(b,function(b,c){var e=c;e.text=c.name,e.children=c.languages,$.each(c.languages,function(a,b){b.text=b.name,d[b.id]=b,b.alt_ids&&$.each(b.alt_ids,function(a,c){d[c]=b})}),a.results.push(e)})}}),c=d,b=a},languagesForSelect2:function(){return b},languageNamed:function(a){return"undefined"!=typeof a?c[a]:void 0},defaultLanguage:function(){return this.languageNamed(this.getPreference("defaultLanguage"))},setDefaultLanguage:function(a){this.setPreference("defaultLanguage",a.id)},clearDefaultLanguage:function(){this.clearPreference("defaultLanguage")},defaultExpiration:function(){return this.getPreference("defaultExpiration","-1")},setDefaultExpiration:function(a){this.setPreference("defaultExpiration",a)},clearDefaultExpiration:function(){this.clearPreference("defaultExpiration")},setPreference:function(a,b){localStorage[a]=b},getPreference:function(a,b){return localStorage[a]||b},clearPreference:function(a){delete localStorage[a]},updatePartial:function(a){$.ajax({type:"GET",url:"/partial/"+a,async:!1,dataType:"html",success:function(b){$("#partial_container_"+a).html(b)}})},_loginReplyHandler:function(a){switch($("#partial_container_login_logout .blocker").fadeOut("fast"),a.status){case"valid":Ghostbin.sendEvent("login","success"),$("#login_error").text("").hide(400),Ghostbin.updatePartial("login_logout"),Ghostbin.displayFlash({type:"success",body:"Successfully logged in."});break;case"moreinfo":Ghostbin.sendEvent("login","registration-required"),$("#login_error").text("").hide(400),"undefined"!=typeof a.invalid_fields&&$.each(a.invalid_fields,function(a,b){var c=$("form#loginForm input[name="+b+"]");c.parents(".control-group").eq(0).show(400),c.focus()}),"undefined"!=typeof a.reason&&$("#login_moreinfo").text(a.reason).show(400);break;case"invalid":Ghostbin.sendEvent("login","failed"),"undefined"!=typeof a.invalid_fields&&$.each(a.invalid_fields,function(a,b){$("form#loginForm input[name="+b+"]").parents(".control-group").eq(0).addClass("error")}),"undefined"!=typeof a.reason&&$("#login_error").text(a.reason).show(400)}},login:function(a){Ghostbin.sendEvent("ui","login-click"),$("#partial_container_login_logout .blocker").fadeIn("fast"),$("form#loginForm .control-group").removeClass("error"),$.ajax({type:"POST",url:"/auth/login",async:!0,dataType:"json",data:a,success:Ghostbin._loginReplyHandler,error:function(){$("#partial_container_login_logout .blocker").fadeOut("fast")}})},logout:function(){Ghostbin.sendEvent("ui","logout-click"),$("#partial_container_login_logout .blocker").fadeIn("fast"),$.ajax({type:"POST",url:"/auth/logout",async:!0,success:function(){$("#partial_container_login_logout .blocker").fadeOut("fast"),Ghostbin.updatePartial("login_logout"),Ghostbin.displayFlash({type:"success",body:"Successfully logged out."})},failure:function(a){$("#partial_container_login_logout .blocker").fadeOut("fast"),alert(a)}})},sendEvent:function(a,b,c){var d={eventCategory:a,eventAction:b};c&&(d.eventValue=c),ga("send","event",d)},displayFlash:function(b){var c=$("#flash-container"),d=c.find("#flash-template").clone();d.removeAttr("id").find("p").text(b.body),b.type&&d.addClass("well-"+b.type),c.append(d),c.show(),a.setTimeout(function(){d.fadeIn(200),a.setTimeout(function(){d.fadeOut(400,function(){c.hide(),d.remove()})},4e3)},500)}}}()}(window),$(function(){"use strict";var a=$("#pasteForm"),b=$("#code"),c=$("#code-editor");if(a.length>0){var d=a.find("#langbox"),e=a.data("context");Ghostbin.loadLanguages(),d.select2({data:Ghostbin.languagesForSelect2(),matcher:function(a,b,c){if(!c.id)return!1;if(c.name.toUpperCase().indexOf((""+a).toUpperCase())>=0)return!0;if(c.id.toUpperCase().indexOf((""+a).toUpperCase())>=0)return!0;for(var d in c.alt_ids)if(c.alt_ids[d].toUpperCase().indexOf((""+a).toUpperCase())>=0)return!0;return!1}});var f=Ghostbin.languageNamed(d.data("selected"))||Ghostbin.defaultLanguage()||Ghostbin.languageNamed("text");if(d.select2("data",f),"new"===e){a.find("input[name='expire']").val(Ghostbin.defaultExpiration());var g=$("#optionsModal");g.modal({show:!1}),g.find("input[type='checkbox']").on("change",function(){Ghostbin.setPreference($(this).data("gb-key"),this.checked?"true":"false")}).each(function(){this.checked="true"===Ghostbin.getPreference($(this).data("gb-key"),"false")}),$("#optionsButton").on("click",function(){Ghostbin.sendEvent("ui","options-click"),g.modal("show")})}a.on("submit",function(){return 0===(c.val().match(/[^\s]/)||[]).length?("new"===e?Ghostbin.sendEvent("paste","create-empty"):Ghostbin.sendEvent("paste","edit-empty"),$("#deleteModal, #emptyPasteModal").modal("show"),!1):("new"===e?(Ghostbin.sendEvent("paste","create"),"true"===Ghostbin.getPreference("saveExpiration","false")?Ghostbin.setDefaultExpiration(a.find("input[name='expire']").val()):Ghostbin.clearDefaultExpiration(),"true"===Ghostbin.getPreference("saveLanguage","false")?Ghostbin.setDefaultLanguage(d.select2("data")):Ghostbin.clearDefaultLanguage()):Ghostbin.sendEvent("paste","edit"),void a.find("input[name='title']").val($("#editable-paste-title").text()))}),$("#editable-paste-title").keypress(function(a){return 13==a.which?($(c).focus(),!1):!0})}!function(){var a=$("#paste-controls");0!==a.length&&a.onMediaQueryChanged("screen and (max-width: 767px)",function(a){this.detach();var b;b=a.matches?$("#phone-paste-control-container"):$("#desktop-paste-control-container"),b.prepend(this)})}(),function(){var b=$("#encryptModal");if(0!==b.length){b.modal({show:!1});var c=b.find("input[type='password']"),d=a.find("input[name='password']");c.keypress(function(a){return 13===a.which?(b.modal("hide"),!1):void 0});var e=function(a){$("#encryptionIcon").removeClass("icon-lock icon-lock-open-alt").addClass(a?"icon-lock":"icon-lock-open-alt"),$("#encryptionButton .button-data-label").text(a?"On":"")};b.on("show",function(){c.val(d.val())}).on("shown",function(){$(this).find("input").eq(0).focus().select()}).on("hidden",function(){d.val(c.val());var a=$(this).find("input").val().length>0;a&&Ghostbin.sendEvent("ui","encrypt-has-password"),e(a)}),$("#encryptionButton").on("click",function(){Ghostbin.sendEvent("ui","encrypt-click"),b.modal("show")})}}(),function(){var b=$("#expireModal");if(0!==b.length){b.modal({show:!1});var c=a.find("input[name='expire']"),d=$("#expirationButton .button-data-label"),e=function(){$(this).button("toggle"),c.val($(this).data("value")),d.text($(this).data("display-value"))};e.call(b.find("button[data-value='"+c.val()+"']")),b.find("button[data-value]").on("click",function(){Ghostbin.sendEvent("ui","expire-set",$(this).data("value")),e.call(this),b.modal("hide")}),$("#expirationButton").on("click",function(){Ghostbin.sendEvent("ui","expire-click"),b.modal("show")})}}();var h=$("#line-numbers");!function(){if(0!==h.length)if(b.length>0){var a=$(document.createElement("div")).addClass("line-highlight-bar").hide().appendTo("body"),d=a.clone().addClass("line-highlight-bar-permanent").appendTo("body"),e=function(a){a.css("left",h.outerWidth()).css("top",$(this).position().top+$(this).parent().position().top).width(b.outerWidth()).show()},f=function(a){"undefined"!=typeof a?(d.data("cur-line",a),history.replaceState({line:a},"","#L"+a)):(d.removeData("cur-line"),history.replaceState(null,"","#"))},g=function(a){if(a){var b=a.match(/^#L(\d+)/);return"undefined"!=typeof b&&b.length>0?b[1]:void 0}};h.fillWithLineNumbers((b.text().match(/\n/g)||[]).length+1,function(){h.children().mouseenter(function(){e.call(this,a)}).mouseleave(function(){a.hide()}).click(function(){var a=$(this).text();return 0+d.data("cur-line")===a?(f(void 0),void d.hide()):(f(a),void e.call(this,d))}),$(window).on("load popstate",function(){var a=g(window.location.hash);if(a){var b=$("span:nth-child("+a+")",h);b.length>0&&(f(a),e.call(b.get(0),d),b.scrollMinimal())}})}),$(window).on("resize",function(){$(a).width(b.outerWidth()),$(d).width(b.outerWidth())}),$(document).on("media-query-changed",function(){e.call($("span:nth-child("+d.data("cur-line")+")",h).get(0),d)})}else c.length>0&&(c.on("input propertychange",function(){h.fillWithLineNumbers((c.val().match(/\n/g)||[]).length+1,function(){$(".textarea-height-wrapper").css("left",h.outerWidth())})}).triggerHandler("input"),$(document).on("media-query-changed",function(){c.triggerHandler("input")}))}(),function(){if(c.length>0){c.keydown(function(b){if(9===b.keyCode&&!b.ctrlKey&&!b.altKey&&!b.shiftKey){var c=[this.selectionStart,this.selectionEnd];return this.value=this.value.substring(0,c[0])+"	"+this.value.substring(c[1],this.value.length),this.selectionStart=this.selectionEnd=c[0]+1,!1}return 83!==b.keyCode||!b.ctrlKey||b.altKey||b.shiftKey?void 0:(Ghostbin.sendEvent("ui","control-s-press"),a.submit(),!1)});var b=!1;c.on("input propertychange",function(){b=!0}),a.on("submit",function(){b=!1});var d=$("[name='deleteForm']");d.on("submit",function(){b=!1}),window.addEventListener("beforeunload",function(a){if(b){Ghostbin.sendEvent("ui","unsaved-changes-shown");var c="If you leave now, your paste will not be saved.";return(a||window.event).returnValue=c,c}})}}(),$("[autofocus]:not(:focus)").eq(0).focus(),$("[title]").tooltip({trigger:"hover",placement:"bottom",container:"body",delay:{show:250,hide:50}});var i=Math.floor((new Date).getTime()/1e3);$("#expirationIcon").tooltip({trigger:"hover",placement:"bottom",container:"body",title:function(){var a=0+$(this).data("reftime"),b=Math.floor((new Date).getTime()/1e3),c=i-a,d=0+$(this).data("value")+c-b;if(d>0)return Ghostbin.sendEvent("ui","expire-hover-shown"),"Expires in "+window.Ghostbin.formatDuration(d);var e=Math.random();return Ghostbin.sendEvent("ui","expire-hover-easter-egg-shown"),.5>=e?"Wha-! It's going to explode! Get out while you still can!":"He's dead, Jim."},delay:{show:250,hide:50}}),function(){var a=Math.random();1e-4>=a&&(Ghostbin.sendEvent("ui","celestia-shown"),$("body").css("background-image","url('/c.png')"))}()}),$(function(){if(docCookies.hasItem("flash")){var a=JSON.parse(atob(docCookies.getItem("flash")));docCookies.removeItem("flash","/"),Ghostbin.displayFlash(a)}});